. ../../config/system
. ../../config/site

sys_incl="$x11_incl $motif_incl"

echo Building Makefile.local...
cat <<EOT >Makefile.local
# This Makefile was produced by running ./build in this directory.

SHELL=/bin/sh

CC= ${cc-cc}
CFLAGS= $cflags $obj_cflags $motif_cflags
LINTFLAGS= $lintflags
SCMFLAGS= -p .:../../scm:../xt

INC=	../../include

H=	\$(INC)/compat.h\\
	\$(INC)/config.h\\
	\$(INC)/cstring.h\\
	\$(INC)/exception.h\\
	\$(INC)/extern.h\\
	\$(INC)/funcproto.h\\
	\$(INC)/gc.h\\
	\$(INC)/misc.h\\
	\$(INC)/object.h\\
	\$(INC)/param.h\\
	\$(INC)/stkmem.h\\
	\$(INC)/type.h\\
	../xlib/xlib.h\\
	../xt/xt.h

O=	arrow-button.o\\
	bulletin-brd.o\\
	cascade-btn.o\\
	command.o\\
	drawing-area.o\\
	drawn-button.o\\
	file-selectn.o\\
	form.o\\
	frame.o\\
	label.o\\
	list.o\\
	main-window.o\\
	message-box.o\\
	paned-window.o\\
	push-button.o\\
	row-column.o\\
	scale.o\\
	scroll-bar.o\\
	scrolled-win.o\\
	selectn-box.o\\
	separator.o\\
	shell.o\\
	support.o\\
	text.o\\
	toggle-btn.o

SO=	arrow-button.so\\
	bulletin-brd.so\\
	cascade-btn.so\\
	command.so\\
	drawing-area.so\\
	drawn-button.so\\
	file-selectn.so\\
	form.so\\
	frame.so\\
	label.so\\
	list.so\\
	main-window.so\\
	message-box.so\\
	paned-window.so\\
	push-button.so\\
	row-column.so\\
	scale.so\\
	scroll-bar.so\\
	scrolled-win.so\\
	selectn-box.so\\
	separator.so\\
	shell.so\\
	support.so\\
	text.so\\
	toggle-btn.so

WIDGET_SET= xm

.SUFFIXES: .d .c .o

.c.o:
	\$(CC) \$(CFLAGS) -I\$(INC) -I../xlib $sys_incl -c \$<
	../../scripts/makedl \$@ \$@

.d.c:
	../../src/scheme \$(SCMFLAGS) -l mkwidget.scm \$< \$@ \$(WIDGET_SET)

.d.o:
	../../src/scheme \$(SCMFLAGS) -l mkwidget.scm \$< \$*.c \$(WIDGET_SET)
	\$(CC) \$(CFLAGS) -I\$(INC) -I../xlib $sys_incl -c \$*.c
	../../scripts/makedl \$@ \$@

all: \$(SO)

arrow-button.o:		\$(H) arrow-button.d
bulletin-brd.o:		\$(H) bulletin-brd.d
cascade-btn.o:		\$(H) cascade-btn.d
command.o:		\$(H) command.d
drawing-area.o:		\$(H) drawing-area.d
drawn-button.o:		\$(H) drawn-button.d
file-selectn.o:		\$(H) file-selectn.d
form.o:			\$(H) form.d
frame.o:		\$(H) frame.d
label.o:		\$(H) label.d
list.o:			\$(H) list.d
main-window.o:		\$(H) main-window.d
message-box.o:		\$(H) message-box.d
paned-window.o:		\$(H) paned-window.d
push-button.o:		\$(H) push-button.d
row-column.o:		\$(H) row-column.d
scale.o:		\$(H) scale.d
scroll-bar.o:		\$(H) scroll-bar.d
scrolled-win.o:		\$(H) scrolled-win.d
selectn-box.o:		\$(H) selectn-box.d
separator.o:		\$(H) separator.d
shell.o:		\$(H) shell.d
support.o:		\$(H) support.d
text.o:			\$(H) text.d
toggle-btn.o:		\$(H) toggle-btn.d

arrow-button.so:	arrow-button.o
	gcc -shared -o \$@ \$< $libxmotif -lc

bulletin-brd.so:	bulletin-brd.o
	gcc -shared -o \$@ \$< $libxmotif -lc

cascade-btn.so:		cascade-btn.o
	gcc -shared -o \$@ \$< $libxmotif -lc

command.so:		command.o
	gcc -shared -o \$@ \$< $libxmotif -lc

drawing-area.so:	drawing-area.o
	gcc -shared -o \$@ \$< $libxmotif -lc

drawn-button.so:	drawn-button.o
	gcc -shared -o \$@ \$< $libxmotif -lc

file-selectn.so:	file-selectn.o
	gcc -shared -o \$@ \$< $libxmotif -lc

form.so:		form.o
	gcc -shared -o \$@ \$< $libxmotif -lc

frame.so:		frame.o
	gcc -shared -o \$@ \$< $libxmotif -lc

label.so:		label.o
	gcc -shared -o \$@ \$< $libxmotif -lc

list.so:		list.o
	gcc -shared -o \$@ \$< $libxmotif -lc

main-window.so:		main-window.o
	gcc -shared -o \$@ \$< $libxmotif -lc

message-box.so:		message-box.o
	gcc -shared -o \$@ \$< $libxmotif -lc

paned-window.so:	paned-window.o
	gcc -shared -o \$@ \$< $libxmotif -lc

push-button.so:		push-button.o
	gcc -shared -o \$@ \$< $libxmotif -lc

row-column.so:		row-column.o
	gcc -shared -o \$@ \$< $libxmotif -lc

scale.so:		scale.o
	gcc -shared -o \$@ \$< $libxmotif -lc

scroll-bar.so:		scroll-bar.o
	gcc -shared -o \$@ \$< $libxmotif -lc

scrolled-win.so:	scrolled-win.o
	gcc -shared -o \$@ \$< $libxmotif -lc

selectn-box.so:		selectn-box.o
	gcc -shared -o \$@ \$< $libxmotif -lc

separator.so:		separator.o
	gcc -shared -o \$@ \$< $libxmotif -lc

shell.so:		shell.o
	gcc -shared -o \$@ \$< $libxmotif -lc

support.so:		support.o
	gcc -shared -o \$@ \$< $libxmotif -lc

text.so:		text.o
	gcc -shared -o \$@ \$< $libxmotif -lc

toggle-btn.so:		toggle-btn.o
	gcc -shared -o \$@ \$< $libxmotif -lc


install: \$(SO)
	-@if [ ! -d $install_dir/lib ]; then \\
	    echo mkdir $install_dir/lib; \\
	    mkdir $install_dir/lib; \\
	fi
	-@if [ ! -d $install_dir/lib/elk ]; then \\
	    echo mkdir $install_dir/lib/elk; \\
	    mkdir $install_dir/lib/elk; \\
	fi
	-@if [ ! -d $install_dir/lib/elk/xm ]; then \\
	    echo mkdir $install_dir/lib/elk/xm; \\
	    mkdir $install_dir/lib/elk/xm; \\
	fi
	@for i in \$(SO) ALIASES ;\\
	do \\
	    echo cp \$\$i $install_dir/lib/elk/xm; \\
	    cp \$\$i $install_dir/lib/elk/xm; \\
	done

lint:
	lint \$(LINTFLAGS) -I\$(INC) -I../xlib $sys_incl *.c

clean:
	rm -f *.so *.o *.c core

distclean:
	rm -f *.so *.o *.c core lint.out Makefile.local
EOT
