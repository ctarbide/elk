. ../../config/system
. ../../config/site

echo Building Makefile.local...
cat <<EOT >Makefile.local
# This Makefile was produced by running ./build in this directory.

SHELL=/bin/sh

CC= ${cc-cc}
CFLAGS= $cflags $obj_cflags
LINTFLAGS= $lintflags

INC=	../../include

H=	\$(INC)/compat.h\\
	\$(INC)/config.h\\
	\$(INC)/cstring.h\\
	\$(INC)/exception.h\\
	\$(INC)/extern.h\\
	\$(INC)/funcproto.h\\
	\$(INC)/gc.h\\
	\$(INC)/misc.h\\
	\$(INC)/object.h\\
	\$(INC)/param.h\\
	\$(INC)/stkmem.h\\
	\$(INC)/type.h\\
	unix.h

C=	error.c\\
	fdescr.c\\
	file.c\\
	lock.c\\
	misc.c\\
	passwd.c\\
	process.c\\
	signal.c\\
	system.c\\
	temp.c\\
	time.c\\
	unix.c\\
	wait.c

O=	error.o\\
	fdescr.o\\
	file.o\\
	lock.o\\
	misc.o\\
	passwd.o\\
	process.o\\
	signal.o\\
	system.o\\
	temp.o\\
	time.o\\
	unix.o\\
	wait.o

all: \$(O) unix.so

.c.o:
	\$(CC) \$(CFLAGS) -I\$(INC) -c \$<

error.o:	\$(H) error.c
fdescr.o:	\$(H) fdescr.c
file.o:		\$(H) file.c
lock.o:		\$(H) lock.c
misc.o:		\$(H) misc.c
passwd.o:	\$(H) passwd.c
process.o:	\$(H) process.c
signal.o:	\$(H) signal.c
system.o:	\$(H) system.c
temp.o:		\$(H) temp.c
time.o:		\$(H) time.c
unix.o:		\$(H) unix.c
wait.o:		\$(H) wait.c

unix.pre: \$(O)
	../../scripts/makedl \$@ \$(O)

unix.so: \$(O)
	gcc -shared -o \$@ \$(O) -lc

install: unix.so
	-@if [ ! -d $install_dir/lib ]; then \\
	    echo mkdir $install_dir/lib; \\
	    mkdir $install_dir/lib; \\
	fi
	-@if [ ! -d $install_dir/lib/elk ]; then \\
	    echo mkdir $install_dir/lib/elk; \\
	    mkdir $install_dir/lib/elk; \\
	fi
	cp unix.so $install_dir/lib/elk
	-@if [ ! -d $install_dir/include ]; then \\
	    echo mkdir $install_dir/include; \\
	    mkdir $install_dir/include; \\
	fi
	-@if [ ! -d $install_dir/include/elk ]; then \\
	    echo mkdir $install_dir/include/elk; \\
	    mkdir $install_dir/include/elk; \\
	fi
	-@if [ ! -d $install_dir/include/elk/extensions ]; then \\
	    echo mkdir $install_dir/include/elk/extensions; \\
	    mkdir $install_dir/include/elk/extensions; \\
	fi
	cp unix.h $install_dir/include/elk/extensions

lint:
	lint \$(LINTFLAGS) -I\$(INC) \$(C)

clean:
	rm -f *.so *.o unix.pre core

distclean:
	rm -f *.so *.o unix.pre core lint.out Makefile.local
EOT
